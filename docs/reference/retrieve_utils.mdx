---
sidebarTitle: retrieve_utils
title: autogen.retrieve_utils
---

## Functions

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### create_vector_db_from_dir
<a href="#autogen.retrieve_utils..create_vector_db_from_dir" class="headerlink" title="Permanent link"></a>

```python
create_vector_db_from_dir(
    dir_path: str | list[str],
    max_tokens: int = 4000,
    client: chromadb.api.ClientAPI = None,
    db_path: str = 'tmp/chromadb.db',
    collection_name: str = 'all-my-documents',
    get_or_create: bool = False,
    chunk_mode: str = 'multi_lines',
    must_break_at_empty_line: bool = True,
    embedding_model: str = 'all-MiniLM-L6-v2',
    embedding_function: Callable = None,
    custom_text_split_function: Callable = None,
    custom_text_types: list[str] = ['txt', 'json', 'csv', 'tsv', 'md', 'html', 'htm', 'rtf', 'rst', 'jsonl', 'log', 'xml', 'yaml', 'yml', 'pdf', 'mdx'],
    recursive: bool = True,
    extra_docs: bool = False
) -> chromadb.api.ClientAPI
```

    Create a vector db from all the files in a given directory, the directory can also be a single file or a url to
        a single file. We support chromadb compatible APIs to create the vector db, this function is not required if
        you prepared your own vector db.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `dir_path` | the path to the directory, file, url or a list of them.<br/><br/>**Type:** `str \| list[str]` |
| `max_tokens` | the maximum number of tokens per chunk.<br/><br/>Default is 4000.<br/><br/>**Type:** `int`<br/><br/>**Default:** 4000 |
| `client` | the chromadb client.<br/><br/>Default is None.<br/><br/>**Type:** `chromadb.api.ClientAPI`<br/><br/>**Default:** None |
| `db_path` | the path to the chromadb.<br/><br/>Default is "tmp/chromadb.db".<br/><br/>The default was `/tmp/chromadb.db` for version `&lt;=0.2.24`.<br/><br/>**Type:** `str`<br/><br/>**Default:** 'tmp/chromadb.db' |
| `collection_name` | the name of the collection.<br/><br/>Default is "all-my-documents".<br/><br/>**Type:** `str`<br/><br/>**Default:** 'all-my-documents' |
| `get_or_create` | Whether to get or create the collection.<br/><br/>Default is False.<br/><br/>If True, the collection will be returned if it already exists.<br/><br/>Will raise ValueError if the collection already exists and get_or_create is False.<br/><br/>**Type:** `bool`<br/><br/>**Default:** False |
| `chunk_mode` | the chunk mode.<br/><br/>Default is "multi_lines".<br/><br/>**Type:** `str`<br/><br/>**Default:** 'multi_lines' |
| `must_break_at_empty_line` | Whether to break at empty line.<br/><br/>Default is True.<br/><br/>**Type:** `bool`<br/><br/>**Default:** True |
| `embedding_model` | the embedding model to use.<br/><br/>Default is "all-MiniLM-L6-v2".<br/><br/>Will be ignored if embedding_function is not None.<br/><br/>**Type:** `str`<br/><br/>**Default:** 'all-MiniLM-L6-v2' |
| `embedding_function` | the embedding function to use.<br/><br/>Default is None, SentenceTransformer with the given `embedding_model` will be used.<br/><br/>If you want to use OpenAI, Cohere, HuggingFace or other embedding functions, you can pass it here, follow the examples in `https://docs.trychroma.com/embeddings`.<br/><br/>**Type:** `Callable`<br/><br/>**Default:** None |
| `custom_text_split_function` | a custom function to split a string into a list of strings.<br/><br/>Default is None, will use the default function in `autogen.retrieve_utils.split_text_to_chunks`.<br/><br/>**Type:** `Callable`<br/><br/>**Default:** None |
| `custom_text_types` | a list of file types to be processed.<br/><br/>Default is TEXT_FORMATS.<br/><br/>**Type:** `list[str]`<br/><br/>**Default:** ['txt', 'json', 'csv', 'tsv', 'md', 'html', 'htm', 'rtf', 'rst', 'jsonl', 'log', 'xml', 'yaml', 'yml', 'pdf', 'mdx'] |
| `recursive` | whether to search documents recursively in the dir_path.<br/><br/>Default is True.<br/><br/>**Type:** `bool`<br/><br/>**Default:** True |
| `extra_docs` | whether to add more documents in the collection.<br/><br/>Default is False<br/><br/>**Type:** `bool`<br/><br/>**Default:** False |

<b>Returns:</b>
| Type | Description |
|--|--|
| `chromadb.api.ClientAPI` | The chromadb client. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### extract_text_from_pdf
<a href="#autogen.retrieve_utils..extract_text_from_pdf" class="headerlink" title="Permanent link"></a>

```python
extract_text_from_pdf(file: str) -> str
```

    Extract text from PDF files

<b>Parameters:</b>
| Name | Description |
|--|--|
| `file` | **Type:** `str` |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### get_file_from_url
<a href="#autogen.retrieve_utils..get_file_from_url" class="headerlink" title="Permanent link"></a>

```python
get_file_from_url(url: str, save_path: str = None) -> tuple[str, str]
```

    Download a file from a URL.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `url` | **Type:** `str` |
| `save_path` | **Type:** `str`<br/><br/>**Default:** None |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### get_files_from_dir
<a href="#autogen.retrieve_utils..get_files_from_dir" class="headerlink" title="Permanent link"></a>

```python
get_files_from_dir(
    dir_path: str | list[str],
    types: list = ['txt', 'json', 'csv', 'tsv', 'md', 'html', 'htm', 'rtf', 'rst', 'jsonl', 'log', 'xml', 'yaml', 'yml', 'pdf', 'mdx'],
    recursive: bool = True
) -> 
```

    Return a list of all the files in a given directory, a url, a file path or a list of them.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `dir_path` | **Type:** `str \| list[str]` |
| `types` | **Type:** `list`<br/><br/>**Default:** ['txt', 'json', 'csv', 'tsv', 'md', 'html', 'htm', 'rtf', 'rst', 'jsonl', 'log', 'xml', 'yaml', 'yml', 'pdf', 'mdx'] |
| `recursive` | **Type:** `bool`<br/><br/>**Default:** True |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### is_url
<a href="#autogen.retrieve_utils..is_url" class="headerlink" title="Permanent link"></a>

```python
is_url(string: str) -> 
```

    Return True if the string is a valid URL.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `string` | **Type:** `str` |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### parse_html_to_markdown
<a href="#autogen.retrieve_utils..parse_html_to_markdown" class="headerlink" title="Permanent link"></a>

```python
parse_html_to_markdown(html: str, url: str = None) -> str
```

    Parse HTML to markdown.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `html` | **Type:** `str` |
| `url` | **Type:** `str`<br/><br/>**Default:** None |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### query_vector_db
<a href="#autogen.retrieve_utils..query_vector_db" class="headerlink" title="Permanent link"></a>

```python
query_vector_db(
    query_texts: list[str],
    n_results: int = 10,
    client: chromadb.api.ClientAPI = None,
    db_path: str = 'tmp/chromadb.db',
    collection_name: str = 'all-my-documents',
    search_string: str = '',
    embedding_model: str = 'all-MiniLM-L6-v2',
    embedding_function: Callable = None
) -> chromadb.api.types.QueryResult
```

    Query a vector db. We support chromadb compatible APIs, it's not required if you prepared your own vector db
        and query function.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `query_texts` | the list of strings which will be used to query the vector db.<br/><br/>**Type:** `list[str]` |
| `n_results` | the number of results to return.<br/><br/>Default is 10.<br/><br/>**Type:** `int`<br/><br/>**Default:** 10 |
| `client` | the chromadb compatible client.<br/><br/>Default is None, a chromadb client will be used.<br/><br/>**Type:** `chromadb.api.ClientAPI`<br/><br/>**Default:** None |
| `db_path` | the path to the vector db.<br/><br/>Default is "tmp/chromadb.db".<br/><br/>The default was `/tmp/chromadb.db` for version `&lt;=0.2.24`.<br/><br/>**Type:** `str`<br/><br/>**Default:** 'tmp/chromadb.db' |
| `collection_name` | the name of the collection.<br/><br/>Default is "all-my-documents".<br/><br/>**Type:** `str`<br/><br/>**Default:** 'all-my-documents' |
| `search_string` | the search string.<br/><br/>Only docs that contain an exact match of this string will be retrieved.<br/><br/>Default is "".<br/><br/>**Type:** `str`<br/><br/>**Default:** '' |
| `embedding_model` | the embedding model to use.<br/><br/>Default is "all-MiniLM-L6-v2".<br/><br/>Will be ignored if embedding_function is not None.<br/><br/>**Type:** `str`<br/><br/>**Default:** 'all-MiniLM-L6-v2' |
| `embedding_function` | the embedding function to use.<br/><br/>Default is None, SentenceTransformer with the given `embedding_model` will be used.<br/><br/>If you want to use OpenAI, Cohere, HuggingFace or other embedding functions, you can pass it here, follow the examples in `https://docs.trychroma.com/embeddings`.<br/><br/>**Type:** `Callable`<br/><br/>**Default:** None |

<b>Returns:</b>
| Type | Description |
|--|--|
| `chromadb.api.types.QueryResult` | The query result. The format is: ```python class QueryResult(TypedDict): ids: List[IDs] embeddings: Optional[List[List[Embedding]]] documents: Optional[List[List[Document]]] metadatas: Optional[List[List[Metadata]]] distances: Optional[List[List[float]]] ``` |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### split_files_to_chunks
<a href="#autogen.retrieve_utils..split_files_to_chunks" class="headerlink" title="Permanent link"></a>

```python
split_files_to_chunks(
    files: list,
    max_tokens: int = 4000,
    chunk_mode: str = 'multi_lines',
    must_break_at_empty_line: bool = True,
    custom_text_split_function: Callable = None
) -> tuple[list[str], list[dict]]
```

    Split a list of files into chunks of max_tokens.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `files` | **Type:** `list` |
| `max_tokens` | **Type:** `int`<br/><br/>**Default:** 4000 |
| `chunk_mode` | **Type:** `str`<br/><br/>**Default:** 'multi_lines' |
| `must_break_at_empty_line` | **Type:** `bool`<br/><br/>**Default:** True |
| `custom_text_split_function` | **Type:** `Callable`<br/><br/>**Default:** None |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### split_text_to_chunks
<a href="#autogen.retrieve_utils..split_text_to_chunks" class="headerlink" title="Permanent link"></a>

```python
split_text_to_chunks(
    text: str,
    max_tokens: int = 4000,
    chunk_mode: str = 'multi_lines',
    must_break_at_empty_line: bool = True,
    overlap: int = 0
) -> 
```

    Split a long text into chunks of max_tokens.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `text` | **Type:** `str` |
| `max_tokens` | **Type:** `int`<br/><br/>**Default:** 4000 |
| `chunk_mode` | **Type:** `str`<br/><br/>**Default:** 'multi_lines' |
| `must_break_at_empty_line` | **Type:** `bool`<br/><br/>**Default:** True |
| `overlap` | **Type:** `int`<br/><br/>**Default:** 0 |

<br />