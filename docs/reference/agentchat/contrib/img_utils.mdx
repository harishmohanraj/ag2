---
sidebarTitle: img_utils
title: autogen.agentchat.contrib.img_utils
---

## Functions

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### convert_base64_to_data_uri
<a href="#autogen.agentchat.contrib.img_utils..convert_base64_to_data_uri" class="headerlink" title="Permanent link"></a>

```python
convert_base64_to_data_uri(base64_image) -> 
```

    

<b>Parameters:</b>
| Name | Description |
|--|--|
| `base64_image` |  |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### extract_img_paths
<a href="#autogen.agentchat.contrib.img_utils..extract_img_paths" class="headerlink" title="Permanent link"></a>

```python
extract_img_paths(paragraph: str) -> list
```

    Extract image paths (URLs or local paths) from a text paragraph.
    
    Parameters:
        paragraph (str): The input text paragraph.
    
    Returns:
        list: A list of extracted image paths.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `paragraph` | **Type:** `str` |

<b>Returns:</b>
| Type | Description |
|--|--|
| `list` | list: A list of extracted image paths. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### get_image_data
<a href="#autogen.agentchat.contrib.img_utils..get_image_data" class="headerlink" title="Permanent link"></a>

```python
get_image_data(image_file: str | ForwardRef('Image.Image'), use_b64=True) -> bytes
```

    Loads an image and returns its data either as raw bytes or in base64-encoded format.
    
    This function first loads an image from the specified file, URL, or base64 string using
    the `get_pil_image` function. It then saves this image in memory in PNG format and
    retrieves its binary content. Depending on the `use_b64` flag, this binary content is
    either returned directly or as a base64-encoded string.
    
    Parameters:
        image_file (str, or Image): The path to the image file, a URL to an image, or a base64-encoded
                          string of the image.
        use_b64 (bool): If True, the function returns a base64-encoded string of the image data.
                        If False, it returns the raw byte data of the image. Defaults to True.
    
    Returns:
        bytes: The image data in raw bytes if `use_b64` is False, or a base64-encoded string
               if `use_b64` is True.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `image_file` | **Type:** `str \| ForwardRef('Image.Image')` |
| `use_b64=True` |  |

<b>Returns:</b>
| Type | Description |
|--|--|
| `bytes` | bytes: The image data in raw bytes if `use_b64` is False, or a base64-encoded string if `use_b64` is True. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### get_pil_image
<a href="#autogen.agentchat.contrib.img_utils..get_pil_image" class="headerlink" title="Permanent link"></a>

```python
get_pil_image(image_file: str | ForwardRef('Image.Image')) -> PIL.Image.Image
```

    Loads an image from a file and returns a PIL Image object.
    
    Parameters:
        image_file (str, or Image): The filename, URL, URI, or base64 string of the image file.
    
    Returns:
        Image.Image: The PIL Image object.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `image_file` | **Type:** `str \| ForwardRef('Image.Image')` |

<b>Returns:</b>
| Type | Description |
|--|--|
| `PIL.Image.Image` | Image.Image: The PIL Image object. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### gpt4v_formatter
<a href="#autogen.agentchat.contrib.img_utils..gpt4v_formatter" class="headerlink" title="Permanent link"></a>

```python
gpt4v_formatter(prompt: str, img_format: str = 'uri') -> list[str | dict]
```

    Formats the input prompt by replacing image tags and returns a list of text and images.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `prompt` | **Type:** `str` |
| `img_format` | **Type:** `str`<br/><br/>**Default:** 'uri' |

<b>Returns:</b>
| Type | Description |
|--|--|
| `list[str \| dict]` | - List[Union[str, dict]]: A list of alternating text and image dictionary items. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### llava_formatter
<a href="#autogen.agentchat.contrib.img_utils..llava_formatter" class="headerlink" title="Permanent link"></a>

```python
llava_formatter(prompt: str, order_image_tokens: bool = False) -> tuple[str, list[str]]
```

    Formats the input prompt by replacing image tags and returns the new prompt along with image locations.
    
    Parameters:
        - prompt (str): The input string that may contain image tags like `&lt;img ...>`.
        - order_image_tokens (bool, optional): Whether to order the image tokens with numbers.
            It will be useful for GPT-4V. Defaults to False.
    
    Returns:
        - Tuple[str, List[str]]: A tuple containing the formatted string and a list of images (loaded in b64 format).

<b>Parameters:</b>
| Name | Description |
|--|--|
| `prompt` | **Type:** `str` |
| `order_image_tokens` | **Type:** `bool`<br/><br/>**Default:** False |

<b>Returns:</b>
| Type | Description |
|--|--|
| `tuple[str, list[str]]` | - Tuple[str, List[str]]: A tuple containing the formatted string and a list of images (loaded in b64 format). |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### message_formatter_pil_to_b64
<a href="#autogen.agentchat.contrib.img_utils..message_formatter_pil_to_b64" class="headerlink" title="Permanent link"></a>

```python
message_formatter_pil_to_b64(messages: list[dict]) -> list[dict]
```

    Converts the PIL image URLs in the messages to base64 encoded data URIs.
    
    This function iterates over a list of message dictionaries. For each message,
    if it contains a 'content' key with a list of items, it looks for items
    with an 'image_url' key. The function then converts the PIL image URL
    (pointed to by 'image_url') to a base64 encoded data URI.
    
    Parameters:
        messages (List[Dict]): A list of message dictionaries. Each dictionary
                               may contain a 'content' key with a list of items,
                               some of which might be image URLs.
    
    Returns:
        List[Dict]: A new list of message dictionaries with PIL image URLs in the
                    'image_url' key converted to base64 encoded data URIs.
    
    Example Input:
        ```python
        [
            \{'content': [\{'type': 'text', 'text': 'You are a helpful AI assistant.'}], 'role': 'system'},
            \{'content': [
                \{'type': 'text', 'text': "What's the breed of this dog here?"},
                \{'type': 'image_url', 'image_url': \{'url': a PIL.Image.Image}},
                \{'type': 'text', 'text': '.'}],
            'role': 'user'}
        ]
        ```
    
    Example Output:
        ```python
        [
            \{'content': [\{'type': 'text', 'text': 'You are a helpful AI assistant.'}], 'role': 'system'},
            \{'content': [
                \{'type': 'text', 'text': "What's the breed of this dog here?"},
                \{'type': 'image_url', 'image_url': \{'url': a B64 Image}},
                \{'type': 'text', 'text': '.'}],
            'role': 'user'}
        ]
        ```

<b>Parameters:</b>
| Name | Description |
|--|--|
| `messages` | **Type:** `list[dict]` |

<b>Returns:</b>
| Type | Description |
|--|--|
| `list[dict]` | List[Dict]: A new list of message dictionaries with PIL image URLs in the 'image_url' key converted to base64 encoded data URIs. Example Input: ```python [ \\{'content': [\\{'type': 'text', 'text': 'You are a helpful AI assistant.'}], 'role': 'system'}, \\{'content': [ \\{'type': 'text', 'text': "What's the breed of this dog here?"}, \\{'type': 'image_url', 'image_url': \\{'url': a PIL.Image.Image}}, \\{'type': 'text', 'text': '.'}], 'role': 'user'} ] ``` Example Output: ```python [ \\{'content': [\\{'type': 'text', 'text': 'You are a helpful AI assistant.'}], 'role': 'system'}, \\{'content': [ \\{'type': 'text', 'text': "What's the breed of this dog here?"}, \\{'type': 'image_url', 'image_url': \\{'url': a B64 Image}}, \\{'type': 'text', 'text': '.'}], 'role': 'user'} ] ``` |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### num_tokens_from_gpt_image
<a href="#autogen.agentchat.contrib.img_utils..num_tokens_from_gpt_image" class="headerlink" title="Permanent link"></a>

```python
num_tokens_from_gpt_image(
    image_data: str | ForwardRef('Image.Image'),
    model: str = 'gpt-4-vision',
    low_quality: bool = False
) -> int
```

    Calculate the number of tokens required to process an image based on its dimensions
    after scaling for different GPT models. Supports "gpt-4-vision", "gpt-4o", and "gpt-4o-mini".
    This function scales the image so that its longest edge is at most 2048 pixels and its shortest
    edge is at most 768 pixels (for "gpt-4-vision"). It then calculates the number of 512x512 tiles
    needed to cover the scaled image and computes the total tokens based on the number of these tiles.
    
    Reference: https://openai.com/api/pricing/

<b>Parameters:</b>
| Name | Description |
|--|--|
| `image_data` | Union[str, Image.Image]: The image data which can either be a base64 encoded string, a URL, a file path, or a PIL Image object.<br/><br/>**Type:** `str \| ForwardRef('Image.Image')` |
| `model` | str: The model being used for image processing.<br/><br/>Can be "gpt-4-vision", "gpt-4o", or "gpt-4o-mini".<br/><br/>**Type:** `str`<br/><br/>**Default:** 'gpt-4-vision' |
| `low_quality` | **Type:** `bool`<br/><br/>**Default:** False |

<b>Returns:</b>
| Type | Description |
|--|--|
| `int` | int: The total number of tokens required for processing the image. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### pil_to_data_uri
<a href="#autogen.agentchat.contrib.img_utils..pil_to_data_uri" class="headerlink" title="Permanent link"></a>

```python
pil_to_data_uri(image: Image.Image) -> str
```

    Converts a PIL Image object to a data URI.
    
    Parameters:
        image (Image.Image): The PIL Image object.
    
    Returns:
        str: The data URI string.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `image` | **Type:** `Image.Image` |

<b>Returns:</b>
| Type | Description |
|--|--|
| `str` | str: The data URI string. |

<br />